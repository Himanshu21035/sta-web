<!-- students-list.component.html -->
<div class="container">
  <div class="header">
    <h2>List of All Students</h2>
  </div>
  
  <div class="tableView">
    <!-- Functions Row -->
    <div class="functions">
      <div class="searchBar">
        <input type="text" placeholder="Search by Name, RegNum or Email" (input)="onSearch($event)">
        <button (click)="clearSearch()">Clear</button>
      </div>
      <div class="export">
        <button (click)="exportToCSV()">Export CSV</button>
      </div>
    </div>

    <!-- Add Student Button -->
    <div class="modalbtn">
      <button (click)="openModal()" class="addStudentBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 4v16m8-8H4"/>
        </svg>
        Add Student
      </button>
    </div>

    <!-- Filter Buttons (2 rows) -->
    <div class="filterButtons">
      <div class="filterRow">
        <button 
          [class.active]="activeFilter() === 'all'" 
          (click)="setFilter('all')" 
          class="filterBtn">
          All Students
        </button>
        <button 
          [class.active]="activeFilter() === 'certified'" 
          (click)="setFilter('certified')" 
          class="filterBtn">
          Certified
        </button>
        <button 
          [class.active]="activeFilter() === 'completed'" 
          (click)="setFilter('completed')" 
          class="filterBtn">
          Completed
        </button>
        <button 
          [class.active]="activeFilter() === 'active'" 
          (click)="setFilter('active')" 
          class="filterBtn">
          Active
        </button>
        <button 
          [class.active]="activeFilter() === 'inactive'" 
          (click)="setFilter('inactive')" 
          class="filterBtn">
          Inactive
        </button>
      </div>
      <div class="filterRow">
        <button 
          [class.active]="activeFilter() === 'feesSubmitted'" 
          (click)="setFilter('feesSubmitted')" 
          class="filterBtn">
          Fees Submitted
        </button>
        <button 
          [class.active]="activeFilter() === 'feesPending'" 
          (click)="setFilter('feesPending')" 
          class="filterBtn">
          Fees Pending
        </button>
        <button 
          [class.active]="activeFilter() === 'deleted'" 
          (click)="setFilter('deleted')" 
          class="filterBtn">
          Deleted
        </button>
      </div>
    </div>

    <!-- Students Table -->
    <table>
      <tr>
        <th>RegNum</th>
        <th>Name</th>
        <th>Course</th>
        <th>Email</th>
        <th>Date of Joining</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
      <tr *ngFor="let s of students(); trackBy: trackByRegNum" 
          (click)="openDetailsModal(s)" 
          class="studentRow">
        <td>{{ s.regNum }}</td>
        <td>{{ s.name }}</td>
        <td>{{ s.Course }}</td>
        <td>{{ s.Email }}</td>
        <td>{{ s.DateOfJoin | date:'mediumDate' }}</td>
        <td>
          <div class="statusBadges">
            <span class="badge certified" *ngIf="s.isCertified">‚úì Certified</span>
            <span class="badge completed" *ngIf="s.isCompleted">‚úì Completed</span>
            <span class="badge active" *ngIf="s.isActive">Active</span>
            <span class="badge inactive" *ngIf="!s.isActive">Inactive</span>
            <span class="badge feesSubmitted" *ngIf="!s.isFeesPending">Fees ‚úì</span>
            <span class="badge feesPending" *ngIf="s.isFeesPending">Fees Pending</span>
          </div>
        </td>
        <td (click)="$event.stopPropagation()">
          <button class="actionBtn edit" (click)="editStudent(s)">Edit</button>
        </td>
      </tr>
    </table>

    <!-- Empty State -->
    <div class="emptyState" *ngIf="students().length === 0">
      <div class="emptyIcon">üë®‚Äçüéì</div>
      <h3>No Students Found</h3>
      <p>{{ activeFilter() === 'all' ? 'Add your first student to get started' : 'No students match the selected filter' }}</p>
    </div>
  </div>
</div>

<!-- MODAL OVERLAY -->
<div class="modalOverlay" *ngIf="showModal" (click)="closeModal($event)">
  <div class="modalContent" [@modalAnimation] (click)="$event.stopPropagation()">
    <div class="modalHeader">
      <h3>{{ title }}</h3>
      <button class="closeBtn" (click)="closeModal()">√ó</button>
    </div>

    <!-- Insert your reactive form HTML here -->
    <form [formGroup]="addStudentModel" (ngSubmit)="onSubmit(title)" novalidate>
     <!-- Row 1: Name & RegNum -->
      <div class="formRow">
        <div class="formGroup">
          <label for="name">Full Name *</label>
          <input 
            id="name"
            type="text" 
            formControlName="name"
            placeholder="Enter student name"
            maxlength="100">
          <div class="error" *ngIf="hasError('name', 'required')">
            Name is required
          </div>
          <div class="error" *ngIf="hasError('name', 'maxlength')">
            Name cannot exceed 100 characters
          </div>
        </div>

        <div class="formGroup">
          <label for="regNum">Registration Number *</label>
          <div *ngIf="isLoadingRegNum" class="skeleton-loader">
        <div class="skeleton-box"></div>
    </div>
          <input 
            id="regNum"
            type="text"
            formControlName="regNum"
            placeholder="STU2026001"
            readonly
            value="addStudentModel.get('regNum')?.value"
            uppercase>
          <div class="error" *ngIf="hasError('regNum', 'required')">
            Registration number is required
          </div>
        </div>
      </div>

      <!-- Row 2: Batch Dates -->
      <div class="formRow">
        <div class="formGroup">
          <label for="batchStart">Batch Start Date *</label>
          <input 
            id="batchStart"
            type="time"
            formControlName="batchStart">
          <div class="error" *ngIf="hasError('batchStart', 'required')">
            Batch start date is required
          </div>
        </div>

        <div class="formGroup">
          <label for="batchEnd">Batch End Date *</label>
          <input 
            id="batchEnd"
            type="time"
            formControlName="batchEnd">
          <div class="error" *ngIf="hasError('batchEnd', 'required')">
            Batch end date is required
          </div>
        </div>
      </div>

      <!-- Row 3: Course & Date of Join -->
      <div class="formRow">
        <div class="formGroup fullWidth">
          <label for="Course">Course *</label>
          <input 
            id="Course"
            type="text"
            formControlName="Course"
            placeholder="e.g., Full Stack Development">
          <div class="error" *ngIf="hasError('Course', 'required')">
            Course is required
          </div>
        </div>

        <div class="formGroup">
          <label for="DateOfJoin">Date of Joining *</label>
          <input 
            id="DateOfJoin"
            type="date"
            formControlName="DateOfJoin">
          <div class="error" *ngIf="hasError('DateOfJoin', 'required')">
            Date of joining is required
          </div>
        </div>
      </div>

      <!-- Row 4: Father Name & DOB -->
      <div class="formRow">
        <div class="formGroup">
          <label for="FatherName">Father's Name *</label>
          <input 
            id="FatherName"
            type="text"
            formControlName="FatherName"
            placeholder="Enter father's name"
            maxlength="100">
          <div class="error" *ngIf="hasError('FatherName', 'required')">
            Father's name is required
          </div>
        </div>

        <div class="formGroup">
          <label for="dob">Date of Birth *</label>
          <input 
            id="dob"
            type="date"
            formControlName="dob"
            max="{{today}}">
          <div class="error" *ngIf="hasError('dob', 'required')">
            Date of birth is required
          </div>
        </div>
      </div>

      <!-- Row 5: Email & Phone Primary -->
      <div class="formRow">
        <div class="formGroup">
          <label for="Email">Email *</label>
          <input 
            id="Email"
            type="email"
            formControlName="Email"
            placeholder="student@example.com">
          <div class="error" *ngIf="hasError('Email', 'required')">
            Email is required
          </div>
          <div class="error" *ngIf="hasError('Email', 'email')">
            Invalid email format
          </div>
        </div>

        <div class="formGroup">
          <label for="PhonePrimary">Primary Phone *</label>
          <input 
            id="PhonePrimary"
            type="tel"
            formControlName="PhonePrimary"
            placeholder="9876543210">
          <div class="error" *ngIf="hasError('PhonePrimary', 'required')">
            Primary phone is required
          </div>
          <div class="error" *ngIf="hasError('PhonePrimary', 'pattern')">
            Invalid phone number format
          </div>
        </div>
      </div>

      <!-- Row 6: Phone Secondary & Address -->
      <div class="formRow">
        <div class="formGroup">
          <label for="PhoneSecondary">Secondary Phone</label>
          <input 
            id="PhoneSecondary"
            type="tel"
            formControlName="PhoneSecondary"
            placeholder="Secondary phone (optional)">
          <div class="error" *ngIf="hasError('PhoneSecondary', 'pattern')">
            Invalid phone number format
          </div>
        </div>

        <div class="formGroup fullWidth">
          <label for="Address">Address *</label>
          <textarea 
            id="Address"
            formControlName="Address"
            placeholder="Complete address"
            rows="2"></textarea>
          <div class="error" *ngIf="hasError('Address', 'required')">
            Address is required
          </div>
        </div>
      </div>

      <!-- Row 7: Qualification, Fees & Certification -->
      <div class="formRow">
        <div class="formGroup">
          <label for="HighestQualification">Highest Qualification *</label>
          <input 
            id="HighestQualification"
            type="text"
            formControlName="HighestQualification"
            placeholder="e.g., 12th CBSE">
          <div class="error" *ngIf="hasError('HighestQualification', 'required')">
            Qualification is required
          </div>
        </div>

        <div class="formGroup">
          <label for="Fees">Course Fees (‚Çπ) *</label>
          <input 
            id="Fees"
            type="number"
            formControlName="Fees"
            placeholder="50000"
            min="0">
          <div class="error" *ngIf="hasError('Fees', 'required')">
            Fees amount is required
          </div>
        </div>

        <!-- <div class="formGroup checkboxGroup">
          <label class="checkboxLabel">
            <input type="checkbox" formControlName="isCertified">
            Certified Student
          </label>
        </div> -->
      </div>

      
      <!-- Submit Buttons -->
      <div class="formActions">
        <button type="button" class="btnSecondary" (click)="closeModal()">
          Cancel
        </button>
        <button type="submit" class="btnPrimary" [disabled]="addStudentModel.invalid">
          {{ editMode ? 'Update Student' : 'Add Student' }}
        </button>
      </div>
    </form>
  </div>
</div>


<div class="modalOverlay" *ngIf="showDetailsModal()" (click)="closeModal($event)">
  <!-- Your existing form modal code here -->
</div>

<!-- STUDENT DETAILS MODAL -->
<div class="modalOverlay detailsOverlay" *ngIf="showDetailsModal()" (click)="closeDetailsModal()">
  <div class="modalContent detailsModal" (click)="$event.stopPropagation()">
    <div class="modalHeader">
      <h3>Student Details</h3>
      <button class="closeBtn" (click)="closeDetailsModal()">√ó</button>
    </div>

    <div class="detailsContent" *ngIf="selectedStudent()">
      <!-- Status Indicators -->
      <div class="statusSection">
        <span class="statusBadge certified" *ngIf="selectedStudent()!.isCertified">‚úì Certified</span>
        <span class="statusBadge completed" *ngIf="selectedStudent()!.isCompleted">‚úì Completed</span>
        <span class="statusBadge" [class.activeStatus]="selectedStudent()!.isActive" [class.inactiveStatus]="!selectedStudent()!.isActive">
          {{ selectedStudent()!.isActive ? 'Active' : 'Inactive' }}
        </span>
        <span class="statusBadge" [class.feesGreen]="!selectedStudent()!.isFeesPending" [class.feesRed]="selectedStudent()!.isFeesPending">
          {{ selectedStudent()!.isFeesPending ? 'Fees Pending' : 'Fees Submitted' }}
        </span>
      </div>

      <!-- Student Information Grid -->
      <div class="detailsGrid">
        <div class="detailItem">
          <label>Registration Number</label>
          <p>{{ selectedStudent()!.regNum }}</p>
        </div>
        <div class="detailItem">
          <label>Full Name</label>
          <p>{{ selectedStudent()!.name }}</p>
        </div>
        <div class="detailItem">
          <label>Father's Name</label>
          <p>{{ selectedStudent()!.FatherName }}</p>
        </div>
        <div class="detailItem">
          <label>Date of Birth</label>
          <p>{{ selectedStudent()!.dob | date:'mediumDate' }}</p>
        </div>
        <div class="detailItem">
          <label>Email</label>
          <p>{{ selectedStudent()!.Email }}</p>
        </div>
        <div class="detailItem">
          <label>Primary Phone</label>
          <p>{{ selectedStudent()!.PhonePrimary }}</p>
        </div>
        <div class="detailItem" *ngIf="selectedStudent()!.PhoneSecondary">
          <label>Secondary Phone</label>
          <p>{{ selectedStudent()!.PhoneSecondary }}</p>
        </div>
        <div class="detailItem fullWidth">
          <label>Address</label>
          <p>{{ selectedStudent()!.Address }}</p>
        </div>
        <div class="detailItem">
          <label>Course</label>
          <p>{{ selectedStudent()!.Course }}</p>
        </div>
        <div class="detailItem">
          <label>Highest Qualification</label>
          <p>{{ selectedStudent()!.HighestQualification }}</p>
        </div>
        <div class="detailItem">
          <label>Date of Joining</label>
          <p>{{ selectedStudent()!.DateOfJoin | date:'mediumDate' }}</p>
        </div>
        <div class="detailItem">
          <label>Batch Period</label>
          <p>{{ selectedStudent()!.batchStart }} - {{ selectedStudent()!.batchEnd }}</p>
        </div>
        <div class="detailItem">
          <label>Course Fees</label>
          <p>‚Çπ{{ selectedStudent()!.Fees }}</p>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="detailsActions">
        <button 
          *ngIf="!selectedStudent()!.isCertified && !selectedStudent()!.isDeleted" 
          class="actionBtn certify"
          (click)="certifyStudent(selectedStudent()!.regNum)">
          Certify Student
        </button>
        
        <button 
          *ngIf="!selectedStudent()!.isCompleted && !selectedStudent()!.isDeleted" 
          class="actionBtn complete"
          (click)="markAsCompleted(selectedStudent()!.regNum)">
          Mark as Completed
        </button>
        
        <button 
          *ngIf="!selectedStudent()!.isActive && !selectedStudent()!.isDeleted" 
          class="actionBtn activate"
          (click)="markActive(selectedStudent()!.regNum)">
          Mark as Active
        </button>
        
        <button 
          *ngIf="selectedStudent()!.isActive && !selectedStudent()!.isDeleted" 
          class="actionBtn deactivate"
          (click)="markInactive(selectedStudent()!.regNum)">
          Mark as Inactive
        </button>
        
        <button 
          *ngIf="selectedStudent()!.isFeesPending && !selectedStudent()!.isDeleted" 
          class="actionBtn feesSubmit"
          (click)="markFeesSubmitted(selectedStudent()!.regNum)">
          Mark Fees Submitted
        </button>
        
        <!-- ‚úÖ DELETE BUTTON (only show if not already deleted) -->
        <button 
          *ngIf="!selectedStudent()!.isDeleted" 
          class="actionBtn delete"
          (click)="deleteStudent(selectedStudent()!.regNum)">
          Mark as Deleted
        </button>
        
        <!-- ‚úÖ RESTORE BUTTON (only show if deleted) -->
        <button 
          *ngIf="selectedStudent()!.isDeleted" 
          class="actionBtn restore"
          (click)="restoreStudent(selectedStudent()!.regNum)">
          Restore Student
        </button>
      </div>
    </div>
  </div>
</div>
